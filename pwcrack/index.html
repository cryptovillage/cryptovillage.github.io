<html><head><title>test</title></head><body>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="/js/jquery-csv.js"></script>
<script src="/js/levenshtein.js"></script>
<style>
  table { 
    border:1px solid black; 
    width: 100%;
  }
  td {
    padding: 20px;
    border: 1px solid black;
    text-align: center;
  }
  .pwc-wrapper {
    display: table;
    padding: 30px;
    margin: 0 auto;
  }
  #password, #go {
    font-size: 200%;
  }
  #loading {
    position: absolute;
    border: 1px solid black;
    padding: 50px;
    background-color: white;
    text-align: center;
    left: 50%;
    top: 20%;
    width: 200px;
    height: 120px;
    margin-left: -100px;
    margin-top: -60px;
  }

</style>
<script>
  
  var shortestWord = '';
  var shortestDist = -1;
  var percent = 0;
  var dictSize = 0;

  function updateProgress() {
    $('.progress-bar').css('width', percent+'%').attr('aria-valuenow', percent);
  }

  function secondsToReadable(seconds) {
    minutes = (seconds / 60);
    hours = (minutes / 60);
    days = (hours / 24);
    weeks = (days / 7);
    year = (days / 365);
    if (year >= 1) {
      return Math.floor(year) + " years"
    }
    if (weeks >= 1) {
      return Math.floor(weeks) + " weeks";
    }
    if (days >= 1) {
      return Math.floor(days) + " days";
    }
    if (hours >= 1) {
      return Math.floor(hours) + " hours";
    }
    if (minutes >= 1) {
      return Math.floor(minutes) + " minutes";
    }
    return "Less than a minute.";
  }

  function displayResults() {
    var card = 2136000000;
    var spc = 55000/3.8 * card;
    var hacker = 8 * card;

    var password = $('#password').val();

    var charset = 93;
    if (!password.match(/[^a-zA-Z0-9]/)) {
      charset = charset - 31;
    }
    if (!password.match(/[A-Z]/)) {
      charset = charset - 26;
    }
    if (!password.match(/[a-z]/)) {
      charset = charset - 26;
    }
    if (!password.match(/[0-9]/)) {
      charset = charset - 10;
    }

    console.log(charset);
    console.log(password.length);
    var bruteKeySpace = Math.pow(charset, password.length);
    console.log(bruteKeySpace);
    var hackerHours = (bruteKeySpace/hacker/60/60/24);
    console.log(hackerHours);

    var dictKeySpace = dictSize * Math.pow((2 * charset * shortestWord.length), shortestDist);

    $('#hacker-brute').html(secondsToReadable(bruteKeySpace/hacker/2));
    $('#govt-brute').html(secondsToReadable(bruteKeySpace/spc/2));


    $('#hacker-dict').html(secondsToReadable(dictKeySpace/hacker/2));
    $('#govt-dict').html(secondsToReadable(dictKeySpace/spc/2));

    percent = 0;
    updateProgress();

  }


  var csv = $.get('/pwcrack/dict.txt', function(data) {
    var dict = $.csv.toArrays(data);
    dictSize = dict.length;
    $('#loading').hide();
    $('#go').click(function() {
      var password = $('#password').val();
      shortestWord = '';
      shortestDist = -1;
      console.log("START");
      var timer = setInterval(function() { updateProgress()}, 300);
      var counter = 0;
      (function asyncLoop() {
        var i = 0;
        for (i = counter; i < dict.length && i < (counter + 3000); i++) {
          if (i % 3000 == 0) {
            percent = (i / dict.length * 100).toFixed(0);
            console.log(percent);
          }
          var word = dict[i][0];
          var dist = new Levenshtein(word, password).distance;
          if (dist < shortestDist || shortestDist == -1) {
            shortestDist = dist;
            shortestWord = word;
            console.log(word + " " + dist);
          }
        }
        counter = i;
        if (counter < dict.length) {
          setTimeout(asyncLoop, 0);
        } else {
          clearInterval(timer);
          setTimeout(function() { updateProgress()}, 0);
          displayResults();
        }
      })();
      console.log("DONE");
    });
  });
</script>

<div id="loading">Loading</div>

<div class="pwc-wrapper">
  <input id="password" type="password" placeholder="Check Password"></input>
  <button id="go">Go</button>
  <div>
    <i>Note</i>: Do not use real passwords. I'm not stealing them, but I could.
  </div>
  <br/>
  <div class="progress">
    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
      Analyzing...
    </div>
  </div>
  <center><h3>How long will it take to crack?</h3></center>
  <table>
    <tr>
      <td>
      </td>
      <td>Amateur<br/>Hacker
      </td>
      <td>Chinese<br/>Government
      </td>
    </tr>
    <tr>
    <td>Simple<br/>Brute Force
      </td>
      <td id="hacker-brute">
      </td>
      <td id="govt-brute">
      </td>
    </tr>
    <tr>
      <td>Simple<br/>Dictionary<br/>Attack
      </td>
      <td id="hacker-dict">
      </td>
      <td id="govt-dict">
      </td>
    </tr>

  </table>
</div>
</div>
</body></html>
